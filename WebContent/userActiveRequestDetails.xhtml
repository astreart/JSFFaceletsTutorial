<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">
<h:head></h:head>
<f:view>
	<h:form>

		<h:outputStylesheet library="css" name="css.css" />

		<h:panelGrid columns="1" cellpadding="3" cellspacing="1">
			<h:outputText
				value="#{(userRequestBean.request.title.toUpperCase())}"
				style="font-weight: bold;" />
			<p:row>
				<p:column colspan="2">
					<h:outputText value="Дата на запитването: "
						style="font-weight: bold;" />
				</p:column>
				<p:column colspan="2">
					<h:outputText value="#{userRequestBean.request.requestDate}" />
				</p:column>
			</p:row>

			<p:row>
				<p:column colspan="2">
					<h:outputText value="Категория: " style="font-weight: bold;" />
				</p:column>
				<p:column colspan="2">
					<h:outputText
						value="#{userRequestBean.request.tEventType.eventTypeName}" />
				</p:column>
			</p:row>
			<p:row>
				<p:column colspan="2">
					<h:outputText value="Описание: " style="font-weight: bold;" />
				</p:column>
				<p:column colspan="2">
					<h:outputText value="#{userRequestBean.request.description}" />
				</p:column>
			</p:row>

			<p:row>
				<p:column colspan="2">
					<h:outputText value="Статус: " style="font-weight: bold;" />
				</p:column>
				<p:column colspan="2">
					<h:outputText
						value="#{userRequestBean.request.hiredAgency != null ? 'В процес на изпълняване на заявката.' : 'В процес на наемане на агенция.'}"
						style="#{userRequestBean.request.hiredAgency != null ? 'color: green;' : 'color:black;'}" />
				</p:column>
			</p:row>

			<p:row>
				<p:column colspan="2">
					<h:outputText
						value="#{userRequestBean.request.hiredAgency != null ? 'Заявката се изпълнява от агенция ' : ''}" />
				</p:column>
				<p:column colspan="2">
					<h:outputText
						value="#{userRequestBean.request.hiredAgency != null ? userRequestBean.request.hiredAgency.tUser.name : ''}"
						style="font-weight: bold;" />
				</p:column>
			</p:row>
		</h:panelGrid>
	</h:form>

	<h:form
		rendered="#{not empty userRequestBean.request.hiredAgency.city}">
		Виж детайли за агенция <h:commandLink
			value="#{userRequestBean.request.hiredAgency.tUser.name}"
			action="agencyDetail?faces-redirect=true">
			<f:setPropertyActionListener target="#{agencyBean.tAgency}"
				value="${userRequestBean.request.hiredAgency}" />
		</h:commandLink>
	</h:form>

	<h:form rendered="#{empty userRequestBean.request.hiredAgency.city}">
		Ако желаете да спрете Вашето запитване, моля натиснете <p:commandLink
			value="ТУК" action="#{userRequestBean.cancelRequest()}">
		</p:commandLink>
	</h:form>

	<h:form
		rendered="#{empty userRequestBean.request.hiredAgency.city and
	        not empty userRequestBean.requestAgencies[userRequestBean.request]}">
	
			Моля, изберете от падащото меню агенция 
					<h:selectOneMenu value="#{userRequestBean.selectedAgencyId}"
			panelStyle="width:150px" effect="fade" style="width:97%"
			required="true"
			requiredMessage="Моля, изберете агенцията, която ще организира Вашето събитие!!!">
			<f:selectItem itemLabel="Избери агенция" noSeletionOption="true" />
			<f:selectItems
				value="#{userRequestBean.requestAgencies[userRequestBean.request]}"
				var="agency" itemLabel="#{agency[0]}" itemValue="#{agency[1]}" />
		</h:selectOneMenu>
				, която да организира Вашето събитие и 
			<p:commandLink value="ПОТВЪРДЕТЕ"
			action="#{userRequestBean.hireAgency()}">
			<f:setPropertyActionListener target="#{userRequestBean.request}"
				value="#{userRequestBean.request}" />
		</p:commandLink>
	</h:form>

	<h:form
		rendered="#{empty userRequestBean.request.hiredAgency.city and empty userRequestBean.requestAgencies[userRequestBean.request]}">
				За да може да наемете агенция, първо трябва да осъществите комуникация <br />
				с някоя от агенциите, организиращи събития от посочения тип!!!
			</h:form>



	<h:form
		rendered="#{not empty userRequestBean.request.hiredAgency.city}">
		
		<p:rating value="#{userRequestBean.rating}" stars="5"
				onRate="#{userRequestBean.rateAgency()}" >
				
				</p:rating>
	</h:form>
	
	<br/>
	<br/>
	
	

	<h:form id="form"
		rendered="#{not empty userRequestBean.requestAgencies[userRequestBean.request]}">
		<p:panel
			header="Разменени съобщения с агенции за организиране на събития"
			footer="" style="margin-bottom:20px">
			<p:accordionPanel style="border:1px solid;" activeIndex="-1">
				<c:forEach
					items="#{userRequestBean.requestAgencies[userRequestBean.request]}"
					var="agency">
					<p:tab title="#{agency[0]}">

						<p:dataTable var="message"
							value="#{userRequestBean.showMessages(userRequestBean.request, agency[1])}"
							id="dataTable#{agency[1]}">

							<f:facet name="footer">
								<p:commandButton
									action="#{userRequestBean.setMessageToAgencyIdValue(agency[1])}"
									onclick="tableDialog.show()" value="Изпрати съобщение" />
							</f:facet>

							<p:column headerText="Написано от"
								style="text-align: center; width:200px;">
								<p:row>
									<h:outputText value="#{message[0]}," />
								</p:row>
								<br />
								<p:row>
									<h:outputText value="#{message[2]}" style="font-weight:bold">
										<f:convertDateTime pattern="dd.MM.yyyy HH:mm" timeZone="GMT+3"
											type="both" dateStyle="long" />
									</h:outputText>
								</p:row>
							</p:column>


							<p:column
								headerText="Разменени съобщение с агенция #{agency[0]}, в отговор на направеното по-горе запитване"
								style="text-align: left">
								<h:outputText value="#{message[1]}" />
							</p:column>

						</p:dataTable>
					</p:tab>
				</c:forEach>

			</p:accordionPanel>

			<p:dialog widgetVar="tableDialog" showEffect="explode"
				hideEffect="explode" header="Напиши съобщение">

				<h:panelGrid columns="1">
					<p:inputTextarea rows="5" cols="32" autoResize="false"
						value="#{userRequestBean.message.messageBody}" resetValues="true" />
					<p:commandButton value="Публикувай съобщението на стената"
						actionListener="#{userRequestBean.addMessage(userRequestBean.request)}"
						oncomplete="tableDialog.hide()" update="form" />
				</h:panelGrid>
			</p:dialog>

		</p:panel>
	</h:form>

	<h:form id="form1"
		rendered="#{empty userRequestBean.requestAgencies[userRequestBean.request]}">
		<p:panel
			header="Разменени съобщения с агенции за организиране на събития">
			Няма разменени съобщения с агенции за организиране на събития.</p:panel>
	</h:form>

</f:view>
</html>
