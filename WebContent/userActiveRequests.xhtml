<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">
<h:head></h:head>
<f:view>

	<h:outputStylesheet library="css" name="css.css" />

	<p:dataGrid id="dataGrid" value="#{userRequestBean.userActiveRequests}"
		columns="1" var="userActiveRequest"
		selection="#{userRequestBean.request}"
		rowKey="#{userActiveRequest.id}">
		<f:facet name="header">
            Моите активни запитвания
        </f:facet>

		<h:panelGrid id="panelGrid" columns="1" cellpadding="3"
			cellspacing="1">
			<h:outputText value="#{userActiveRequest.title.toUpperCase()}"
				style="font-weight: bold;" />
			<h:outputText value="#{userActiveRequest.description}" />

			<p:row>
				<p:column colspan="2">
					<h:outputText value="Статус: " style="font-weight: bold;" />
				</p:column>
				<p:column colspan="2">
					<h:outputText
						value="#{userActiveRequest.hiredAgency != null ? 'В процес на изпълняване на заявката.' : 'В процес на наемане на агенция.'}"
						style="#{userActiveRequest.hiredAgency != null ? 'color: green;' : 'color:black;'}" />
				</p:column>
			</p:row>

			<p:row>
				<p:column colspan="2">
					<h:outputText
						value="#{userActiveRequest.hiredAgency != null ? 'Заявката се изпълнява от агенция ' : ''}" />
				</p:column>
				<p:column colspan="2">
					<h:outputText
						value="#{userActiveRequest.hiredAgency != null ? userActiveRequest.hiredAgency.tUser.name : ''}"
						style="font-weight: bold;" />
				</p:column>
			</p:row>

			<h:form rendered="#{not empty userActiveRequest.hiredAgency}">
				<h:commandLink
					value="Виж детайли за агенция #{userActiveRequest.hiredAgency.tUser.name}"
					action="agencyDetail?faces-redirect=true">
					<f:setPropertyActionListener target="#{agencyBean.tAgency}"
						value="${userActiveRequest.hiredAgency}" />
				</h:commandLink>
			</h:form>

			<h:form rendered="#{empty userActiveRequest.hiredAgency}">
					Ако желаете да спрете Вашето запитване, моля натиснете <p:commandLink
					value="ТУК" action="#{userRequestBean.cancelRequest()}"
					update=":dataGrid">
					<f:setPropertyActionListener target="#{userRequestBean.request}"
						value="${userActiveRequest}" />
				</p:commandLink>
			</h:form>

			<h:form
				rendered="#{empty userActiveRequest.hiredAgency.city and
	        not empty userRequestBean.requestAgencies[userActiveRequest]}">
			Моля, изберете от падащото меню агенция 
					<h:selectOneMenu value="#{userRequestBean.selectedAgencyId}"
					panelStyle="width:150px" effect="fade" style="width:97%"
					required="true"
					requiredMessage="Моля, изберете агенцията, която ще организира Вашето събитие!!!">
					<f:selectItem itemLabel="Избери агенция" noSeletionOption="true" />
					<f:selectItems
						value="#{userRequestBean.requestAgencies[userActiveRequest]}"
						var="agency" itemLabel="#{agency[0]}" itemValue="#{agency[1]}" />
				</h:selectOneMenu>
				, която да организира Вашето събитие и 
			<p:commandLink value="ПОТВЪРДЕТЕ"
					action="#{userRequestBean.hireAgency()}" update=":dataGrid">
					<f:setPropertyActionListener target="#{userRequestBean.request}"
						value="${userActiveRequest}" />
				</p:commandLink>
			</h:form>

			<h:form
				rendered="#{empty userActiveRequest.hiredAgency.city and empty userRequestBean.requestAgencies[userActiveRequest]}">
				За да може да наемете агенция, първо трябва да осъществите комуникация <br />
				с някоя от агенциите, организиращи събития от посочения тип!!!
			</h:form>

			<p:commandButton value="Детайли"
				action="userRequestDetails?faces-redirect=true">
				<f:setPropertyActionListener target="#{userRequestBean.request}"
					value="${userActiveRequest}" />
			</p:commandButton>
		</h:panelGrid>
		<hr />
	</p:dataGrid>


</f:view>
</html>
